// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction();updateHash()};
function scrollFunction() {
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        document.getElementById("myBtn").style.display = "block";
    } else {
        document.getElementById("myBtn").style.display = "none";
    }
}
// When the user clicks on the button, scroll to the top of the document
function topFunction() {
    // smoothscroll towards beginning content table
    var $target = $("#maia-main");
    $('html, body').stop().animate({
        'scrollTop': $target.offset().top
    }, 500,'swing');
    // document.body.scrollTop = 0; // For Chrome, Safari and Opera
    // document.documentElement.scrollTop = 0; // For IE and Firefox
}
// take window size to adapt the cover image size
$(window).on('load', function() {
    var theWindow        = $(window),
        bg              = $("div.im-container"),
        aspectRatio      = bg.width() / bg.height();
    function resizeBg() {
        if ( (theWindow.width() / theWindow.height()) < aspectRatio ) {
            bg.css("height",theWindow.height())
        } else {
            bg.css("width",theWindow.width())
        }
    }
    theWindow.resize(resizeBg).trigger("resize");
});
//smoothscroll when clicking on round button
$(document).ready(function(){
    $('a[href ^="#"]').on('click', function(e){
        e.preventDefault();
        var target = this.hash;
        var $target = $(target);
        $('html, body').stop().animate({
            'scrollTop': $target.offset().top
        }, 500,'swing');
    });
});

//add anchor properties to p elements on runtime
$(document).ready(function(){
    var counter = 1;
    $('p', '.page').each(function (idx, el) {
        $(el).attr("id",counter);
        $(el).addClass("anchor");
        $(el).attr('href','#'+counter)
        counter = counter+1;
    });
});

//update url Hash on scroll
function updateHash() {
    var allVisible  = [];
    $(".anchor").each(function (idx, el) {
        if ( isElementInViewport(el) ) {
            allVisible.push("#" + $(el).attr("id"))
        }
    });
    var urlHash = allVisible[0]; //display hash corresponding to top visible element
    window.history.pushState(null, null, urlHash);
}

//check if element is visible
function isElementInViewport (el) {
    if (typeof jQuery === "function" && el instanceof jQuery) {el = el[0];}
    var rect = el.getBoundingClientRect();
    return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /*or $(window).height() */
        rect.right <= (window.innerWidth || document.documentElement.clientWidth) /*or $(window).width() */
    );
}
// click-to-scroll behavior
$(".anchor").click(function (e) {
    e.preventDefault();
    var section = this.href;
    var sectionClean = section.substring(section.indexOf("#"));
    $("html, body").animate({
        scrollTop: $(sectionClean).offset().top
    }, 1000, function () {
        window.location.hash = sectionClean;
    });
});